<template>
    <div class="shop-page-wrapper">
      <HeaderWithTopbar containerClass="container"/>
      <Breadcrumb pageTitle="Шинэ бараа"/>
  
      <!-- product items wrapper -->
      <div class="shop-area pt-100 pb-100">
        <div class="container">
          <div class="row">
            <div class="col-lg-9">
              <!-- shop top bar -->
              <div class="shop-top-bar">
                <div class="select-showing-wrap">
                  <div class="shop-select">
                    <select v-model="selectedPrice">
                      <option value="default">Үнээр эрэмблэх</option>
                      <option value="low2high">Үнэ - Багаас их рүү</option>
                      <option value="high2low">Үнэ - Ихээс бага руу</option>
                    </select>
                  </div>
                  <p>Showing {{ perPage * currentPage - perPage + 1 }} to
                    {{ perPage * currentPage > filterItems.length ? filterItems.length : perPage * currentPage }} of
                    {{ filterItems.length }} result</p>
                </div>
                <div class="shop-tab">
                  <button @click="layout = 'twoColumn'" :class="{ active : layout === 'twoColumn' }">
                    <i class="fa fa-th-large"></i>
                  </button>
                  <button @click="layout = 'threeColumn'" :class="{ active : layout === 'threeColumn' }">
                    <i class="fa fa-th"></i>
                  </button>
                  <button @click="layout = 'list'" :class="{ active : layout === 'list' }">
                    <i class="fa fa-list-ul"></i>
                  </button>
                </div>
              </div>
              <!-- end shop top bar -->
  
              <!-- shop product -->
<!--              <div class="shop-bottom-area mt-35">-->
<!--                <n-link to="/product/product-detail">-->
<!--                  <div class="row product-layout"-->
<!--                      :class="{ 'list': layout === 'list', 'grid three-column': layout === 'threeColumn', 'grid two-column': layout === 'twoColumn' }">-->
<!--                      tueryterutyreutyeruityeruiteryiu-->
<!--                    <div class="col-xl-4 col-sm-6" v-for="(product, index) in getItems" :key="index">-->
<!--                      <ProductNewWrapper/>-->
<!--                    </div>-->
<!--                  </div>-->
<!--                </n-link>-->
<!--              </div>-->

              <div class="shop-bottom-area mt-35">

                <div class="row product-layout"
                     :class="{ 'list': layout === 'list', 'grid three-column': layout === 'threeColumn', 'grid two-column': layout === 'twoColumn' }">
                  <div class="col-xl-4 col-sm-6" v-for="(product, index) in getItems" :key="index">
                    <ProductGridItem :product="product" :layout="layout"/>
                  </div>
                </div>

              </div>

              <!-- end shop product -->
  
              <div v-if="getPaginateCount > 1">
                <pagination class="pro-pagination-style shop-pagination mt-30" v-model="currentPage" :per-page="perPage"
                            :records="filterItems.length" @paginate="paginateClickCallback"
                            :page-count="getPaginateCount"/>
              </div>
            </div>
  
          </div>
        </div>
      </div>
      <!-- end product items wrapper -->
  
      <QuickView/>
      <TheFooter/>
    </div>
  </template>
  
  <script>
  
  import {mapActions} from 'vuex';
  
  export default {
    components: {
      HeaderWithTopbar: () => import('@/components/HeaderWithTopbar'),
      Breadcrumb: () => import('@/components/Breadcrumb'),
      ProductGridItem: () => import('@/components/product/ProductGridItem'),
      QuickView: () => import('@/components/QuickView'),
      TheFooter: () => import('@/components/TheFooter'),
    },
  
    data() {
      return {
        layout: "threeColumn",
        filterItems: [],
        prevSelectedParentName: '',
        prevSelectedChildName: '',
        prevSelectedCategoryName: '',
        currentPage: 1,
        perPage: 9,
        selectedPrice: 'default'
      }
    },
  
    computed: {
      products() {
        return this.$store.getters.getNewProducts;
      },
  
      getItems() {
        let start = (this.currentPage - 1) * this.perPage;
        let end = this.currentPage * this.perPage;
        return this.filterItems.slice(start, end);
      },
      getPaginateCount() {
        return Math.ceil(this.filterItems.length / this.perPage);
      },
    },
  
    mounted() {
      this.fetchData();
      this.updateProductData()
    },
  
    methods: {
      ...mapActions(['fetchProducts']),
      ...mapActions(['fetchCategories']),
      async fetchData() {
        await this.fetchProducts();
        await this.fetchCategories();
      },
  
      paginateClickCallback(page) {
        this.currentPage = Number(page);
      },
  
      updateProductData() {
        this.paginateClickCallback(1);

  
        if (Object.keys(this.$route.query).length === 0) {
          this.filterItems = [...this.products]
        }

  
      },
  
      slugify(text) {
        return String(text)
            // .toString()
            .toLowerCase()
            .replace(/\s+/g, "-") // Replace spaces with -
            // .replace(/[^\w-]+/g, "") // Remove all non-word chars
            .replace(/--+/g, "-") // Replace multiple - with single -
            .replace(/^-+/, "")
            .replace(/,+/, "")  // Trim - from start of text
            .replace(/-+$/, ""); // Trim - from end of text
      }
    },
  
    watch: {
      $route() {
        this.updateProductData()
      },
  
      selectedPrice() {
        switch (this.selectedPrice) {
          case "low2high":
            this.filterItems = this.filterItems.sort((a, b) => a.price - b.price)
            break;
          case "high2low":
            this.filterItems = this.filterItems.sort((a, b) => b.price - a.price)
            break;
          default:
            this.filterItems = [...this.products]
        }
      }
    },
  
    head() {
      return {
        title: "Shop grid standard"
      }
    },
  };
  </script>
  